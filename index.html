<!DOCTYPE html>
<html>
<head>
    <title>Aeternum Imperium - PROTOTYPE</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Arial', sans-serif; 
            background: #000;
            color: white;
            overflow: hidden;
        }
        
        /* Login Screen */
        #loginScreen {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: radial-gradient(circle at center, #0a0a2a 0%, #000 70%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .login-box {
            background: rgba(20, 20, 60, 0.9);
            padding: 40px;
            border-radius: 15px;
            border: 2px solid #00a2ff;
            box-shadow: 0 0 50px rgba(0, 162, 255, 0.5);
            text-align: center;
            width: 350px;
        }
        
        .login-box h1 {
            margin-bottom: 30px;
            color: #00f3ff;
            font-size: 28px;
        }
        
        .login-box input {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #00a2ff;
            border-radius: 8px;
            color: white;
            font-size: 16px;
        }
        
        .login-box button {
            width: 100%;
            padding: 15px;
            margin-top: 20px;
            background: linear-gradient(45deg, #0066cc, #00a2ff);
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
        }
        
        .login-box button:hover {
            background: linear-gradient(45deg, #00a2ff, #00f3ff);
            transform: scale(1.05);
        }
        
        /* Game UI */
        #gameUI {
            position: absolute;
            top: 0; left: 0;
            width: 100%;
            padding: 20px;
            z-index: 100;
            pointer-events: none;
        }
        
        .top-bar {
            display: flex;
            justify-content: space-between;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #00a2ff;
            margin-bottom: 20px;
        }
        
        .resource {
            margin: 0 15px;
            font-size: 18px;
        }
        
        .resource span {
            color: #00f3ff;
            font-weight: bold;
        }
        
        #playerInfo {
            position: absolute;
            top: 100px;
            right: 20px;
            background: rgba(0, 20, 40, 0.9);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #00ff88;
            width: 250px;
        }
        
        #otherPlayers {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 20, 40, 0.9);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #ffaa00;
            width: 300px;
        }
        
        .player-list {
            max-height: 200px;
            overflow-y: auto;
            margin-top: 10px;
        }
        
        .player-item {
            padding: 5px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        #chatBox {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 300px;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid #ff00ff;
            border-radius: 10px;
            padding: 10px;
        }
        
        #chatMessages {
            height: 150px;
            overflow-y: auto;
            margin-bottom: 10px;
        }
        
        #chatInput {
            width: 100%;
            padding: 8px;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #ff00ff;
            color: white;
            border-radius: 5px;
        }
        
        /* Action Buttons */
        #actionButtons {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
        }
        
        .action-btn {
            padding: 15px 25px;
            background: linear-gradient(45deg, #0066cc, #00a2ff);
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: 0.3s;
            pointer-events: auto;
        }
        
        .action-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 0 20px #00a2ff;
        }
        
        /* Canvas */
        #gameCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>

<!-- Login Screen -->
<div id="loginScreen">
    <div class="login-box">
        <h1>AETERNUM IMPERIUM</h1>
        <input type="text" id="username" placeholder="Commander Name" maxlength="20">
        <input type="password" id="password" placeholder="Access Code">
        <button onclick="login()">INITIATE PROTOCOL</button>
        <p style="margin-top: 20px; color: #aaa; font-size: 12px;">
            New commanders: Use any credentials
        </p>
    </div>
</div>

<!-- Game UI (Hidden until login) -->
<div id="gameUI" style="display: none;">
    <div class="top-bar">
        <div style="display: flex;">
            <div class="resource">ENERGY: <span id="energy">1000</span></div>
            <div class="resource">CREDITS: <span id="credits">500</span></div>
            <div class="resource">IRON: <span id="iron">0</span></div>
            <div class="resource">VOLCANIUM: <span id="volcanium">0</span></div>
        </div>
        <div style="color: #00ff88; font-size: 20px;">
            GALAXY: <span id="galaxyName">Terra Nova</span>
        </div>
    </div>
    
    <div id="playerInfo">
        <h3 style="color: #00ff88;">COMMANDER <span id="playerName">USER</span></h3>
        <p>Level: <span id="playerLevel">1</span></p>
        <p>Fleet: <span id="fleetSize">1</span> ships</p>
        <p>Worlds: <span id="worldsOwned">1</span> controlled</p>
    </div>
    
    <div id="otherPlayers">
        <h3 style="color: #ffaa00;">OTHER COMMANDERS (5)</h3>
        <div class="player-list" id="playerList">
            <!-- Players will appear here -->
        </div>
    </div>
    
    <div id="chatBox">
        <div id="chatMessages">
            <div style="color: #00a2ff;">[SYSTEM] Welcome to Aeternum Imperium</div>
        </div>
        <input type="text" id="chatInput" placeholder="Type message..." onkeypress="chatKeyPress(event)">
    </div>
    
    <div id="actionButtons">
        <button class="action-btn" onclick="mineResource()">‚õèÔ∏è MINE</button>
        <button class="action-btn" onclick="buildShip()">üöÄ BUILD</button>
        <button class="action-btn" onclick="jumpToWorld()">üåå JUMP</button>
        <button class="action-btn" onclick="attack()">‚öîÔ∏è ATTACK</button>
    </div>
</div>

<script>
// ======================
// GAME STATE
// ======================
let playerData = {
    username: '',
    level: 1,
    resources: {
        energy: 1000,
        credits: 500,
        iron: 0,
        volcanium: 0,
        cryo_crystal: 0
    },
    unlockedWorlds: ['Terra Nova'],
    currentWorld: 'Terra Nova',
    ships: ['Scout-001'],
    lastLogin: Date.now()
};

let otherPlayers = [
    { name: 'NOVA_PRIME', level: 15, online: true, world: 'Pyros V' },
    { name: 'VOID_WALKER', level: 8, online: true, world: 'Cryos-7' },
    { name: 'SIRIUS_BLADE', level: 22, online: false, world: 'Quantica' },
    { name: 'ORION_KING', level: 3, online: true, world: 'Terra Nova' },
    { name: 'CELESTIA', level: 12, online: true, world: 'Zephyr Prime' }
];

// ======================
// THREE.JS SETUP
// ======================
let scene, camera, renderer, controls;
let playerShip, planets = [], asteroids = [];

function init3D() {
    // Scene
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0x000010);
    
    // Camera
    camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    camera.position.set(0, 10, 20);
    
    // Renderer
    renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.shadowMap.enabled = true;
    renderer.shadowMap.type = THREE.PCFSoftShadowMap;
    document.body.appendChild(renderer.domElement);
    
    // Controls
    controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.dampingFactor = 0.05;
    
    // Lighting
    const ambientLight = new THREE.AmbientLight(0x333333);
    scene.add(ambientLight);
    
    const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
    directionalLight.position.set(5, 10, 7);
    directionalLight.castShadow = true;
    scene.add(directionalLight);
    
    const starsLight = new THREE.PointLight(0x00aaff, 2, 50);
    starsLight.position.set(10, 5, 0);
    scene.add(starsLight);
    
    // Create player ship
    const shipGeometry = new THREE.ConeGeometry(1, 3, 8);
    const shipMaterial = new THREE.MeshPhongMaterial({ 
        color: 0x0066ff,
        shininess: 100,
        specular: 0x444444
    });
    playerShip = new THREE.Mesh(shipGeometry, shipMaterial);
    playerShip.position.set(0, 0, 0);
    playerShip.rotation.x = Math.PI / 2;
    scene.add(playerShip);
    
    // Create planet (Terra Nova)
    const planetGeometry = new THREE.SphereGeometry(8, 32, 32);
    const planetMaterial = new THREE.MeshPhongMaterial({
        color: 0x2ecc71,
        shininess: 30,
        specular: 0x222222
    });
    const planet = new THREE.Mesh(planetGeometry, planetMaterial);
    planet.position.set(20, 0, 0);
    planet.castShadow = true;
    planet.receiveShadow = true;
    scene.add(planet);
    planets.push(planet);
    
    // Create asteroids
    for (let i = 0; i < 15; i++) {
        const size = Math.random() * 1.5 + 0.5;
        const asteroidGeometry = new THREE.DodecahedronGeometry(size, 0);
        const asteroidMaterial = new THREE.MeshPhongMaterial({
            color: 0x888888,
            shininess: 50
        });
        const asteroid = new THREE.Mesh(asteroidGeometry, asteroidMaterial);
        
        const angle = Math.random() * Math.PI * 2;
        const distance = 15 + Math.random() * 20;
        asteroid.position.set(
            Math.cos(angle) * distance,
            (Math.random() - 0.5) * 10,
            Math.sin(angle) * distance
        );
        
        asteroid.rotation.set(
            Math.random() * Math.PI,
            Math.random() * Math.PI,
            Math.random() * Math.PI
        );
        
        scene.add(asteroid);
        asteroids.push({
            mesh: asteroid,
            rotationSpeed: (Math.random() - 0.5) * 0.02
        });
    }
    
    // Add stars
    const starGeometry = new THREE.BufferGeometry();
    const starCount = 1000;
    const starPositions = new Float32Array(starCount * 3);
    
    for (let i = 0; i < starCount * 3; i += 3) {
        starPositions[i] = (Math.random() - 0.5) * 200;
        starPositions[i + 1] = (Math.random() - 0.5) * 200;
        starPositions[i + 2] = (Math.random() - 0.5) * 200;
    }
    
    starGeometry.setAttribute('position', new THREE.BufferAttribute(starPositions, 3));
    
    const starMaterial = new THREE.PointsMaterial({
        color: 0xffffff,
        size: 0.1,
        transparent: true
    });
    
    const stars = new THREE.Points(starGeometry, starMaterial);
    scene.add(stars);
    
    // Handle window resize
    window.addEventListener('resize', onWindowResize, false);
    
    // Start animation
    animate();
}

function onWindowResize() {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
}

function animate() {
    requestAnimationFrame(animate);
    
    // Rotate ship
    if (playerShip) {
        playerShip.rotation.y += 0.01;
    }
    
    // Rotate asteroids
    asteroids.forEach(asteroid => {
        asteroid.mesh.rotation.x += asteroid.rotationSpeed;
        asteroid.mesh.rotation.y += asteroid.rotationSpeed;
    });
    
    // Rotate planets
    planets.forEach(planet => {
        planet.rotation.y += 0.002;
    });
    
    controls.update();
    renderer.render(scene, camera);
}

// ======================
// LOGIN SYSTEM
// ======================
function login() {
    const username = document.getElementById('username').value.trim();
    const password = document.getElementById('password').value;
    
    if (!username) {
        alert("Enter commander name!");
        return;
    }
    
    // Save player data
    playerData.username = username;
    
    // Try to load saved data
    const savedData = localStorage.getItem(`player_${username}`);
    if (savedData) {
        if (password === 'test123' || password === 'password') { // Simple demo password check
            playerData = JSON.parse(savedData);
            playerData.lastLogin = Date.now();
            addChatMessage('[SYSTEM] Welcome back, Commander!', '#00ff88');
        } else {
            alert("Access denied! Try: test123");
            return;
        }
    } else {
        // New player
        addChatMessage(`[SYSTEM] New commander detected: ${username}`, '#00a2ff');
        addChatMessage('[SYSTEM] Mining protocol activated', '#00a2ff');
    }
    
    // Hide login, show game
    document.getElementById('loginScreen').style.display = 'none';
    document.getElementById('gameUI').style.display = 'block';
    
    // Initialize 3D
    init3D();
    
    // Update UI
    updateUI();
    updatePlayerList();
}

// ======================
// GAME FUNCTIONS
// ======================
function mineResource() {
    const resources = playerData.resources;
    resources.iron += Math.floor(Math.random() * 5) + 3;
    resources.energy -= 2;
    
    if (playerData.currentWorld === 'Pyros V') {
        resources.volcanium += Math.floor(Math.random() * 3) + 1;
        addChatMessage(`Mined Volcanium! (+${resources.volcanium})`, '#ff5500');
    }
    
    // Check level up
    if (resources.iron >= playerData.level * 100) {
        playerData.level++;
        addChatMessage(`[LEVEL UP!] Now Level ${playerData.level}`, '#ff00ff');
    }
    
    updateUI();
    saveGame();
}

function buildShip() {
    if (playerData.resources.iron >= 50 && playerData.resources.energy >= 100) {
        playerData.resources.iron -= 50;
        playerData.resources.energy -= 100;
        
        const shipNum = playerData.ships.length + 1;
        playerData.ships.push(`Frigate-${shipNum.toString().padStart(3, '0')}`);
        
        addChatMessage(`[CONSTRUCTED] ${playerData.ships[playerData.ships.length-1]}`, '#00ff88');
        updateUI();
        saveGame();
    } else {
        addChatMessage('[ERROR] Need 50 Iron & 100 Energy', '#ff5555');
    }
}

function jumpToWorld() {
    const worlds = ['Terra Nova', 'Pyros V', 'Cryos-7', 'Zephyr Prime', 'Graviton Core'];
    const currentIndex = worlds.indexOf(playerData.currentWorld);
    const nextIndex = (currentIndex + 1) % worlds.length;
    
    if (nextIndex > currentIndex && !playerData.unlockedWorlds.includes(worlds[nextIndex])) {
        if (playerData.level >= nextIndex * 2) {
            playerData.unlockedWorlds.push(worlds[nextIndex]);
            addChatMessage(`[UNLOCKED] New world: ${worlds[nextIndex]}!`, '#ffff00');
        } else {
            addChatMessage(`[LOCKED] Need Level ${nextIndex * 2} for ${worlds[nextIndex]}`, '#ff5555');
            return;
        }
    }
    
    playerData.currentWorld = worlds[nextIndex];
    addChatMessage(`[JUMP] Entering ${playerData.currentWorld}...`, '#00a2ff');
    
    // Change planet color based on world
    if (planets[0]) {
        const colors = {
            'Terra Nova': 0x2ecc71,
            'Pyros V': 0xff3300,
            'Cryos-7': 0x00ccff,
            'Zephyr Prime': 0xffcc00,
            'Graviton Core': 0x9900ff
        };
        planets[0].material.color.setHex(colors[playerData.currentWorld] || 0x2ecc71);
    }
    
    updateUI();
    saveGame();
}

function attack() {
    const enemyNames = ['Xeno Drone', 'Pirate Scout', 'Rebel Fighter', 'Alien Hive'];
    const enemy = enemyNames[Math.floor(Math.random() * enemyNames.length)];
    
    const win = Math.random() > 0.3;
    
    if (win) {
        const loot = Math.floor(Math.random() * 30) + 20;
        playerData.resources.credits += loot;
        playerData.resources.energy -= 10;
        addChatMessage(`[VICTORY] Defeated ${enemy}! +${loot} Credits`, '#00ff88');
    } else {
        playerData.resources.energy -= 20;
        playerData.ships.pop(); // Lose a ship
        addChatMessage(`[DEFEAT] Lost to ${enemy}! Ship destroyed.`, '#ff5555');
    }
    
    updateUI();
    saveGame();
}

// ======================
// MULTIPLAYER / CHAT
// ======================
function chatKeyPress(event) {
    if (event.key === 'Enter') {
        const input = document.getElementById('chatInput');
        const message = input.value.trim();
        
        if (message) {
            addChatMessage(`${playerData.username}: ${message}`, '#ffffff');
            
            // Simulate other players responding
            if (Math.random() > 0.7 && message.toLowerCase().includes('?')) {
                setTimeout(() => {
                    const responses = [
                        "I'm mining on Pyros V, great resources here!",
                        "Anyone want to trade Volcanium for Cryo-Crystals?",
                        "Watch out for pirates near the asteroid belt!",
                        "The Graviton Core world is insane, gravity shifts constantly!",
                        "Building my 10th frigate, almost ready for the boss fight!"
                    ];
                    const randomPlayer = otherPlayers.filter(p => p.online)[0];
                    if (randomPlayer) {
                        addChatMessage(`${randomPlayer.name}: ${responses[Math.floor(Math.random() * responses.length)]}`, '#ffaa00');
                    }
                }, 1000 + Math.random() * 2000);
            }
            
            input.value = '';
        }
    }
}

function addChatMessage(message, color) {
    const chat = document.getElementById('chatMessages');
    const msgDiv = document.createElement('div');
    msgDiv.style.color = color;
    msgDiv.style.marginBottom = '5px';
    msgDiv.style.fontSize = '14px';
    msgDiv.textContent = message;
    chat.appendChild(msgDiv);
    chat.scrollTop = chat.scrollHeight;
}

function updatePlayerList() {
    const list = document.getElementById('playerList');
    list.innerHTML = '';
    
    otherPlayers.forEach(player => {
        const div = document.createElement('div');
        div.className = 'player-item';
        div.innerHTML = `
            <span style="color: ${player.online ? '#00ff88' : '#ff5555'}">‚óè</span>
            <strong>${player.name}</strong> 
            <span style="color: #aaa;">(Lvl ${player.level})</span>
            <br>
            <span style="font-size: 12px; color: #00a2ff;">${player.world}</span>
        `;
        list.appendChild(div);
    });
}

// ======================
// UI & SAVE SYSTEM
// ======================
function updateUI() {
    document.getElementById('playerName').textContent = playerData.username;
    document.getElementById('playerLevel').textContent = playerData.level;
    document.getElementById('fleetSize').textContent = playerData.ships.length;
    document.getElementById('worldsOwned').textContent = playerData.unlockedWorlds.length;
    
    const res = playerData.resources;
    document.getElementById('energy').textContent = res.energy;
    document.getElementById('credits').textContent = res.credits;
    document.getElementById('iron').textContent = res.iron;
    document.getElementById('volcanium').textContent = res.volcanium;
    document.getElementById('galaxyName').textContent = playerData.currentWorld;
}

function saveGame() {
    localStorage.setItem(`player_${playerData.username}`, JSON.stringify(playerData));
    addChatMessage('[AUTO-SAVE] Progress saved', '#aaa');
}

// Auto-save every 30 seconds
setInterval(() => {
    if (playerData.username) {
        saveGame();
    }
}, 30000);

// Simulate other players joining/leaving
setInterval(() => {
    if (playerData.username) {
        // Randomly change online status
        otherPlayers.forEach(player => {
            if (Math.random() > 0.8) {
                player.online = !player.online;
            }
        });
        updatePlayerList();
    }
}, 10000);

// Auto-mine every 10 seconds
setInterval(() => {
    if (playerData.username && playerData.resources.energy > 0) {
        playerData.resources.iron += 1;
        playerData.resources.energy += 5; // Regen
        updateUI();
    }
}, 10000);

// Instructions popup
window.onload = function() {
    setTimeout(() => {
        if (!localStorage.getItem('shownInstructions')) {
            alert("WELCOME TO AETERNUM IMPERIUM PROTOTYPE!\n\n" +
                  "LOGIN: Use any name, password 'test123'\n" +
                  "MINING: Click ‚õèÔ∏è to gather resources\n" +
                  "BUILD: Click üöÄ to construct ships\n" +
                  "JUMP: Click üåå to unlock new worlds\n" +
                  "ATTACK: Click ‚öîÔ∏è to fight enemies\n\n" +
                  "Progress saves automatically!");
            localStorage.setItem('shownInstructions', 'true');
        }
    }, 1000);
};
</script>

</body>
</html>
